
### 微前端服务架构入门(一)

#### 一： 什么是微前端? 它有什么优势?

  微前端是一种类似于微服务的架构，它将微服务的理念应用到浏览器端，它将多个小型前端应用的聚合成一个大型复杂的单体应用，各个小型前端应用开发可以独立运行, 独立开发，独立部署。

#### 二：前端为什么需要微服务？

  1. 目前大多数应用中，各模块的功能划分清晰，特别是不同页面间的功能，基本可以分割开，而类似的功能在不同的应用中也经常出现, 我们前端在开发重复的模块花费了很多时间。
  2. 对于快速变化的市场，需要短时间内出demo或产品，而微服务的存在，可以快速组合应用，应对市场需求，类似阿里飞冰的拖拽应用(可视化搭建框架)。或天猫的乐高编辑器。
  3. 后端的微服务往往只考虑后端应用的实际情况，很多接口提供的数据并不适合前端进行UI展示，前端需要处理大量的逻辑，以适配界面，久而久之，前端逻辑繁重，代码难于维护。
  4. 前端需要支撑不同的终端，像移动端、PC端。

#### 微服务带来的有那些好处？

1. 轻耦合：使得各功能模块间耦合度降低。
2. 高复用：单个微服务可在多个应用中使用，免去了重复开发的工作量。
3. 独立性：各个服务可以独立运行、独立开发、独立部署。
4. 与技术无关：各服务之间可以使用不同的前端技术进行开发。
5. 快速集成：服务可以任意组合，迅速形成新的应用，以满足需求。
6. 扩展性：每个服务可以独立扩展，满足业务的伸缩性。

#### 三：微前端应用场景在哪里？

#### 解决大型复杂中后台遗留系统，才是使用微前端方案最重要的一个应用场景。

1. 项目技术栈过于老旧,相关技能的开发人员少,功能扩展吃力,重构成本高,维护成本高.
2. 项目过于庞大,代码编译慢,开发体差,需要一种更高维度的解耦方案.
3. 单一技术栈无法满足我们的业务需求

#### 微前端服务最主要特点是：我们可以使用不同的前端框架去编写我们的业务，最后把各个小系统应用去聚合到我们主系统中
去。

#### 四：微前端架构常见有如下几种方案：

4.1  使用HTTP服务器的路由来重定向多个应用。

4.2  使用IFrame来自定义消息传递机制。

4.3  使用Single-SPA

#### 4.1 使用HTTP服务器的路由来重定向多个应用

  路由分发式微前端：是指通过路由将不同的业务分发到不同的，独立前端应用上。
  那么如何做分发式微前端呢? 一般是通过路由分发的Nginx反向代理来实现的。

比如如下Nginx反向代理配置：
```
http {
  server {
    listen:   80;
    server_name   www.xxx.com;
    location /api/ {
      proxy_pass  http://192.168.5.46:8080/api;
    }
    location /web {
      proxy_pass  http://192.168.5.46:8081/web;
   }
   location /web/xxx {
      proxy_pass http://192.168.5.46:8082/web/xxx
   }
   location / {
      proxy_pass /;
   }
  }
}
```
在如上配置中，我们将不同的页面的请求被分发到不同的服务器上。但是该方式看上去更像是：多个前端应用的聚合，即我们只是将这些不同的前端应用拼凑到一起了，使他们看起来像是一个完整的整体。但是它有一个很大的缺点是：每次用户从A应用跳转到B应用的时候，需要刷新下页面。用户体验并不好。

#### 4.2  使用IFrame来自定义消息传递机制。

iframe表示嵌套在浏览器的上下文，能有效的将另一个html页面嵌入到当前页面中。iframe有一个独立的宿主环境，也就是说我们的前端应用之间可以互相独立运行。

#### 但是Iframe有如下缺点：

1. 如果把应用嵌套在另一个应用中，SEO搜索引擎不支持。
2. 页面加载问题：它会影响主页面加载，阻塞onload事件。页面缓存过多会导致电脑卡顿。
3. 布局问题：iframe必须指定高度，否则会不显示，解决办法有：子系统实时计算高度并通过postMessage发送到主页面，主页面动态设置高度。并且有时候会出现多个滚动条，用户体验不佳。
4. 浏览器前进/后退问题。iframe和主页面共用一个浏览历史，iframe会影响页面的前进后退。
5. 不同源的系统之间的通讯需要通过postMessage, 存在一定的安全性。

#### 优点：

1. 完全隔离了css和js，避免各个系统之间的样式和js被污染。
2. 可以在页面中直接嵌入iframe其他页面。

#### 4.3  使用Single-SPA

#### 优点：

1. 用户体验好，快，内容的改变不需要重新加载整个页面，避免了不必要的跳转和重复渲染。
2. 减轻服务器的压力。服务器只提供接口数据即可。不用管页面展示和页面合成。
3. 前后端分离，架构清晰，前后端进行交互逻辑，后端只提供接口数据即可。

#### 缺点：

1. 首屏加载慢，如果我们不对路由进行处理的话，在加载首页时候，会将所有组件全部加载，并且向服务器请求数据。
解决方案： 可以使用Vue-router懒加载。
2. 不利于SEO搜索引擎。解决的方案：使用服务器端渲染。

#### 五. 使用微服务我们需要考虑如下问题：

1. 我们如何实现在一个页面里渲染多种技术栈?
2. 不同技术栈的独立模块之间如何通讯?
3. 如何通过路由渲染到正确的模块?
4. 在不同技术栈之间的路由该如何正确触发?
5. 项目代码被切割之后,通过何种方式合并到一起?
6. 我们的每一个模块项目如何打包?7. 前端微服务化后我们该如何编写我们的代码?
8. 独立团队之间该如何协作?

#### 六：单体应用   VS  前端微服务

如下图所示：

<img src="https://github.com/tugenhua0707/micro-front-end/tree/master/vue-micro-front-end/images/1.png"> <br />

<img src="https://github.com/tugenhua0707/micro-front-end/tree/master/vue-micro-front-end/images/2.png"> <br />

#### 七：前端微服务架构DEMO实践 --- vue项目

项目链接地址：

#### 使用微前端开发，可以总结如下几个优点：

1. 可以缩小主项目和各个子项目的打包体积，使打包速度更快，并且组合后的公共资源只需要一次性加载，性能得到很大
的提升。(从技术角度考虑)
2. 用户体验更好，用户感知不到自己在使用多个不同的项目，更加的平顺流畅。(从产品角度考虑)。
3. 不同的子项目我们可以使用github上进行管理，并且各个子项目模块可以随意拼接一个新项目，产品灵活在本质上得到提升。（从产品或技术上的考虑）。
4. 技术创新，使用业界先进的微前端理念。几十个模块甚至上百个模块，也能更好的管理。（从管理模块上考虑）。







